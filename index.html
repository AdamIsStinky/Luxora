<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scaply Stock Simulator</title>
  <style>
    body { margin:0; font-family:Arial; background:#000; color:#fff; display:flex; justify-content:center; padding:20px; }
    .container { max-width:800px; width:100%; }
    header { text-align:center; margin-bottom:20px; }
    h1 { margin:0; font-size:2rem; letter-spacing:1px; }
    .stats { display:flex; justify-content:space-between; background:#111; padding:15px; border-radius:8px; margin-bottom:20px; }
    .stat { text-align:center; }
    .stat h2 { margin:0; font-size:1.2rem; }
    .stat p { margin:5px 0 0; color:#bbb; }
    .controls { display:flex; gap:10px; margin-bottom:20px; }
    input { flex:1; padding:10px; border:1px solid #444; border-radius:6px; background:#111; color:#fff; }
    button { padding:10px 15px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
    .buy { background:#0f0; color:#000; }
    .sell { background:#f00; color:#fff; }
    .history { background:#111; padding:15px; border-radius:8px; max-height:300px; overflow-y:auto; }
    .history h3 { margin-top:0; }
    .history ul { list-style:none; padding:0; margin:0; }
    .history li { padding:8px 0; border-bottom:1px solid #222; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // ===== Firebase config =====
    const firebaseConfig = {
      apiKey: "AIzaSyAtbXqId49sEwkj6zIvUzQUkfWLaZUm2EE",
      authDomain: "scaply-29f62.firebaseapp.com",
      projectId: "scaply-29f62",
      storageBucket: "scaply-29f62.firebasestorage.app",
      messagingSenderId: "505427041338",
      appId: "1:505427041338:web:a6c4e439c87ece9079a903",
      measurementId: "G-6FC2E11NN4",
      databaseURL: "https://scaply-29f62-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Scaply Stock Simulator</h1>
      <p>Start with $100,000 virtual money</p>
    </header>

    <div class="stats">
      <div class="stat">
        <h2 id="cash">$100,000</h2>
        <p>Cash</p>
      </div>
      <div class="stat">
        <h2 id="shares">0</h2>
        <p>Shares Owned</p>
      </div>
      <div class="stat">
        <h2 id="price">$100</h2>
        <p>Scaply Price</p>
      </div>
    </div>

    <div class="controls">
      <input type="number" id="amount" placeholder="Enter shares..." min="1">
      <button class="buy" onclick="buy()">Buy</button>
      <button class="sell" onclick="sell()">Sell</button>
    </div>

    <div class="history">
      <h3>Transaction History</h3>
      <ul id="history"></ul>
    </div>
  </div>

  <script>
    // ===== Local user data =====
    let cash = 100000;
    let shares = 0;

    const cashEl = document.getElementById("cash");
    const sharesEl = document.getElementById("shares");
    const priceEl = document.getElementById("price");
    const historyEl = document.getElementById("history");

    // ===== Listen to shared price =====
    let price = 100;
    db.ref('price').on('value', snapshot => {
      price = snapshot.val() || 100;
      updateUI();
    });

    // ===== Listen to shared history =====
    db.ref('history').on('child_added', snapshot => {
      const item = snapshot.val();
      const li = document.createElement("li");
      li.textContent = item;
      historyEl.prepend(li);
    });

    // ===== Update UI =====
    function updateUI() {
      cashEl.textContent = "$" + cash.toLocaleString();
      sharesEl.textContent = shares;
      priceEl.textContent = "$" + price.toFixed(2);
    }

    // ===== Buy / Sell =====
    function buy() {
      const amount = parseInt(document.getElementById("amount").value);
      if (!amount || amount <= 0) return;
      const cost = amount * price;
      if (cost > cash) { alert("Not enough cash!"); return; }
      cash -= cost;
      shares += amount;
      db.ref('history').push(`Bought ${amount} shares at $${price.toFixed(2)}`);
      updateUI();
    }

    function sell() {
      const amount = parseInt(document.getElementById("amount").value);
      if (!amount || amount <= 0) return;
      if (amount > shares) { alert("Not enough shares!"); return; }
      const revenue = amount * price;
      cash += revenue;
      shares -= amount;
      db.ref('history').push(`Sold ${amount} shares at $${price.toFixed(2)}`);
      updateUI();
    }

    // ===== Simulate price changes (shared) =====
    setInterval(() => {
      const change = (Math.random() - 0.5) * 10;
      price = Math.max(1, price + change);
      db.ref('price').set(price);
    }, 5000);

    updateUI();
  </script>
</body>
</html>