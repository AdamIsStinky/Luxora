<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scaply Stock Simulator</title>
<style>
  body { margin:0; font-family:Arial; background:#000; color:#fff; display:flex; justify-content:center; padding:20px; }
  .container { max-width:800px; width:100%; }
  .hidden { display:none; }
  header { text-align:center; margin-bottom:20px; }
  h1 { margin:0; font-size:2rem; letter-spacing:1px; }
  .stats { display:flex; justify-content:space-between; background:#111; padding:15px; border-radius:8px; margin-bottom:20px; }
  .stat { text-align:center; }
  .stat h2 { margin:0; font-size:1.2rem; }
  .stat p { margin:5px 0 0; color:#bbb; }
  .controls { display:flex; gap:10px; margin-bottom:20px; }
  input { flex:1; padding:10px; border:1px solid #444; border-radius:6px; background:#111; color:#fff; }
  button { padding:10px 15px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
  .buy { background:#0f0; color:#000; }
  .sell { background:#f00; color:#fff; }
  .history { background:#111; padding:15px; border-radius:8px; max-height:300px; overflow-y:auto; }
  .history h3 { margin-top:0; }
  .history ul { list-style:none; padding:0; margin:0; }
  .history li { padding:8px 0; border-bottom:1px solid #222; }
  #startBtn { margin-top:10px; padding:10px 15px; background:#0f0; color:#000; font-weight:bold; text-align:center; border-radius:6px; cursor:pointer; user-select:none; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAtbXqId49sEwkj6zIvUzQUkfWLaZUm2EE",
  authDomain: "scaply-29f62.firebaseapp.com",
  projectId: "scaply-29f62",
  storageBucket: "scaply-29f62.firebasestorage.app",
  messagingSenderId: "505427041338",
  appId: "1:505427041338:web:a6c4e439c87ece9079a903",
  measurementId: "G-6FC2E11NN4",
  databaseURL: "https://scaply-29f62-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
</head>
<body>
<div class="container">

  <!-- Nickname input -->
  <div id="nicknameScreen">
    <header><h1>Enter Your Nickname</h1></header>
    <input type="text" id="nickname" placeholder="Nickname">
    <div id="startBtn">Start</div>
  </div>

  <!-- Main game screen -->
  <div id="gameScreen" class="hidden">
    <header><h1>Scaply Stock Simulator</h1></header>

    <div class="stats">
      <div class="stat"><h2 id="cash">$100,000</h2><p>Cash</p></div>
      <div class="stat"><h2 id="shares">0</h2><p>Shares Owned</p></div>
      <div class="stat"><h2 id="price">$100</h2><p>Scaply Price</p></div>
      <div class="stat"><h2 id="totalValue">$100,000</h2><p>Total Value</p></div>
    </div>

    <div class="controls">
      <input type="number" id="amount" placeholder="Enter shares..." min="1">
      <button class="buy" onclick="buy()">Buy</button>
      <button class="sell" onclick="sell()">Sell</button>
    </div>

    <div class="history">
      <h3>Transaction History</h3>
      <ul id="history"></ul>
    </div>
  </div>

</div>

<script>
window.onload = function() {
  let nickname;
  let cash = 100000;
  let shares = 0;
  let price = 100;

  const cashEl = document.getElementById("cash");
  const sharesEl = document.getElementById("shares");
  const priceEl = document.getElementById("price");
  const totalEl = document.getElementById("totalValue");
  const historyEl = document.getElementById("history");

  // Mobile-friendly Start button
  document.getElementById('startBtn').addEventListener('click', startGame);

  function startGame() {
    nickname = document.getElementById("nickname").value.trim();
    if (!nickname) { alert("Enter a nickname!"); return; }

    db.ref('users/' + nickname).get().then(snapshot => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        cash = data.cash;
        shares = data.shares;
      } else {
        db.ref('users/' + nickname).set({ cash, shares });
      }

      document.getElementById("nicknameScreen").classList.add("hidden");
      document.getElementById("gameScreen").classList.remove("hidden");
      updateUI();
    });

    // Listen to shared price
    db.ref('price').on('value', snapshot => {
      price = snapshot.val() || 100;
      updateUI();
    });

    // Listen to shared history
    db.ref('history').on('child_added', snapshot => {
      const item = snapshot.val();
      const li = document.createElement("li");
      li.textContent = item;
      historyEl.prepend(li);
    });

    // Initialize price if it doesn't exist
    db.ref('price').once('value').then(snapshot => {
      if (!snapshot.exists()) db.ref('price').set(100);
    });

    // Start price simulation
    setInterval(() => {
      db.ref('price').once('value').then(snap => {
        let p = snap.val() || 100;
        const change = (Math.random() - 0.5) * 10;
        p = Math.max(1, p + change);
        db.ref('price').set(p);
        db.ref('history').push(`Price changed to $${p.toFixed(2)}`);
      });
    }, 5000);
  }

  function updateUI() {
    cashEl.textContent = "$" + cash.toLocaleString();
    sharesEl.textContent = shares;
    priceEl.textContent = "$" + price.toFixed(2);
    totalEl.textContent = "$" + (cash + shares * price).toLocaleString();
  }

  window.buy = function() {
    const amount = parseInt(document.getElementById("amount").value);
    if (!amount || amount <= 0) return;
    const cost = amount * price;
    if (cost > cash) { alert("Not enough cash!"); return; }
    cash -= cost;
    shares += amount;
    db.ref('users/' + nickname).set({ cash, shares });
    db.ref('history').push(`${nickname} bought ${amount} shares at $${price.toFixed(2)}`);
    updateUI();
  }

  window.sell = function() {
    const amount = parseInt(document.getElementById("amount").value);
    if (!amount || amount <= 0) return;
    if (amount > shares) { alert("Not enough shares!"); return; }
    const revenue = amount * price;
    cash += revenue;
    shares -= amount;
    db.ref('users/' + nickname).set({ cash, shares });
    db.ref('history').push(`${nickname} sold ${amount} shares at $${price.toFixed(2)}`);
    updateUI();
  }
}
</script>
</body>
</html>
